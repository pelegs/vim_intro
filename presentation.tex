\documentclass{beamer}
\usepackage[utf8]{inputenc}
\graphicspath{figures}

\usepackage{tabu}
\usepackage{array}
\newcolumntype{!}{>{\global\let\currentrowstyle\relax}}
\newcolumntype{^}{>{\currentrowstyle}}
\newcommand{\rowstyle}[1]{\gdef\currentrowstyle{#1}%
  #1\ignorespaces
}
\newcommand\setrow[1]{\gdef\rowmac{#1}#1\ignorespaces}
\newcommand\clearrow{\global\let\rowmac\relax}
\clearrow

\usepackage{booktabs}
\usepackage{multirow}
\usepackage{xparse}

\usepackage{graphicx}
\usepackage{colortbl}
\definecolor{xblue}{HTML}{4268BD}
\definecolor{xred}{HTML}{BD4242}
\definecolor{xgreen}{HTML}{52B256}
\definecolor{xpurple}{HTML}{7F52B2}
\definecolor{xorange}{HTML}{B93F0B}
\definecolor{vimgreen}{HTML}{019833}
\definecolor{vimgray}{HTML}{CCCCCC}

\usepackage{keystroke}
\usepackage{menukeys}

\setlength{\parskip}{1em}

\mode<presentation>{
	\usetheme{Copenhagen}
	\setbeamercolor{title}{fg=white}
	\setbeamercolor{structure}{fg=vimgreen}
	\setbeamercolor*{palette quaternary}{fg=black,bg=vimgray}
}

\newcommand{\aleft}{$\leftarrow$}
\newcommand{\adown}{$\downarrow$}
\newcommand{\aup}{$\uparrow$}
\newcommand{\aright}{$\rightarrow$}

%------------------------------------------------------------

\title{Introduction to vim}
\author{Peleg Sapir}
\date{August 26, 2021}

%------------------------------------------------------------

\makeatletter
\setbeamertemplate{title page}{
  \vbox{}
  \vfill
  \begingroup
    \centering
		\begin{picture}(0,0)
			\put(60,10){\makebox(0,0)[rt]{\includegraphics[scale=0.2]{figures/cover/cover.pdf}}}
		\end{picture}
		\vskip7em
    \begin{beamercolorbox}[sep=8pt,center]{title}
      \usebeamerfont{title}\inserttitle\par%
      \ifx\insertsubtitle\@empty%
      \else%
        \vskip0.25em%
        {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
      \fi%
    \end{beamercolorbox}%
    \vskip-2em\par
    \begin{beamercolorbox}[sep=8pt,center]{author}
      \usebeamerfont{author}
    \end{beamercolorbox}
    \begin{beamercolorbox}[sep=8pt,center]{institute}
      \usebeamerfont{institute}\insertinstitute
    \end{beamercolorbox}
    % -----------------------
    \begin{beamercolorbox}[sep=8pt,center]{author}
      \usebeamerfont{author}Peleg Sapir
    \end{beamercolorbox}
    \begin{beamercolorbox}[sep=8pt,center]{institute}
      \usebeamerfont{institute}exocad GmbH
    \end{beamercolorbox}
    % ------------------------
    \begin{beamercolorbox}[sep=8pt,center]{date}
      \usebeamerfont{date}\insertdate
    \end{beamercolorbox}\vskip0.5em
    {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}
  \endgroup
  \vfill
}
\makeatother

%------------------------------------------------------------

\usepackage{pgfplots}
\usepackage{tikz}
\usetikzlibrary{positioning, calc, math, shapes, arrows, decorations.pathreplacing, decorations.text, tikzmark}
\tikzset{
	key/.style={draw=black, thick, rounded corners=0.5mm, fill=vimgray, inner sep=1mm, minimum width=5mm, minimum height=5mm},
	grammer/.style={draw=#1, very thick, fill=#1, fill opacity=0.2, text=#1, text opacity=1, minimum height=7.5mm},
	rep/.style={grammer={xblue}, rounded corners},
	opr/.style={grammer={xred}},
	mtn/.style={grammer={xgreen!80!black}},
	cmd/.style={grammer={xpurple}},
	mdf/.style={grammer={xorange}},
}

\renewcommand{\tikzmark}[1]{\tikz[overlay,remember picture] \node (#1) {};}

\newcommand{\key}[1]{\tikz[baseline, yshift=0.75ex]{\node[key] {#1}}}

\renewcommand{\keys}[1]{
	\hspace{-7.5pt}
	\tikz[baseline, node distance=1mm]{
		\node[inner sep=0pt, outer sep=0pt] (0) at (0,0) {};
		\foreach \x [count=\xi] in {#1}{
			\pgfmathsetmacro{\xip}{\xi-1}
			\node[key, right=of \xip] (\xi) {\x};
		}
	}
}

%\newcommand{command}

\usepackage{listofitems}
\newcommand{\vimcmd}[1]{
	\setsepchar{;}
	\readlist*\list{#1}
	\foreachitem\x\in\list[]{
		\setsepchar{,}
		\readlist*\word{\x}
		\tikz[baseline]{
			\def\arg{\word[1]}
			\node[\arg] {\word[2]}
		}
	}
}

%------------------------------------------------------------

\usepackage[most]{tcolorbox}
\newenvironment{pexample}{
  \begin{tcolorbox}[colback=vimgray!20, colframe=vimgreen, coltitle=white, fonttitle=\bfseries, title=Example]
}
{
  \end{tcolorbox}
}

%------------------------------------------------------------

\begin{document}
\frame{\titlepage}
\renewcommand{\arraystretch}{1.4}

\begin{frame}
	\frametitle{The Most Important Command}
	Before we start, let's settle down the age-old question:

	\begin{figure}[H]
		\centering
		\includegraphics[scale=0.3]{figures/exit/exitsign.pdf}
	\end{figure}
\end{frame}

\begin{frame}
	\frametitle{The Most Important Command}
	The most common exit and save commands:
	\begin{table}
		\centering
		\begin{tabu}[H]{!l^l^l}
			\toprule
			\rowstyle{\bfseries}
			Command & Keys \\
			\midrule
			Simple exit & \keys{:,q,\return}\\
			Save & \keys{:,w,\return}\\
			Save and exit & \keys{:,w,q,\return}\\
			Exit without save & \keys{:,q,!,\return}\\
			Save and override & \keys{:,w,!,\return}\\
			Command history & \keys{\tikzmark{q}q,:\tikzmark{c},\return}\\
			\bottomrule
		\end{tabu}
	\end{table}

	\begin{tikzpicture}[overlay, remember picture, node distance=1mm]
		\draw[thick, vimgreen] ($(q.north west)+(-2mm,1mm)$) rectangle ($(c.south east)+(-2.5mm,0.5mm)$);
		\node[vimgreen, below=of q, xshift=2mm] (txt) {Just to confuse ;)};
	\end{tikzpicture}
\end{frame}

\begin{frame}
	\frametitle{Vim Modes}
	Vim has three \textbf{modes}:

	\vspace{5mm}
	\tabulinesep=1.2mm
	\centering
	\begin{tabu}[H]{!l^l^l}
		\toprule
		\rowstyle{\bfseries}
		Name & Function & Key(s)\\
		\midrule
		Normal & navigation and text editing & Default/\key{Esc} \\
		Insert & inserting text & \key{i} \\
		Normal & highlighting text/rows/blocks & \key{v}/\key{V}/\key{Ctrl}+\key{v} \\
		\bottomrule
	\end{tabu}
\end{frame}

\begin{frame}
	\frametitle{Vim Grammer}
	Generaly speaking, vim commands can be structure in different forms (here refered to as "rules" (CITE)).

	The most simple rule is
	\[
	\vimcmd{cmd,command} = \vimcmd{opr,operator}\ \vimcmd{mtn,motion(s)}
	\]

	\vspace{-7mm}
	\begin{pexample}
		\tabulinesep=1.2mm
		\centering
		\begin{tabu}[H]{!l^l^l}
			\toprule
			\rowstyle{\bfseries}
			Command & Syntax & Keys \\
			\midrule
			Delete word & \vimcmd{opr,del;mtn,word} & \keys{d,w} \\
			Copy until 'A' & \vimcmd{opr,copy;mtn,until 'A'}& \keys{y,f,A} \\
			\bottomrule
		\end{tabu}
	\end{pexample}
\end{frame}

\begin{frame}
	\frametitle{Vim Grammer}
	Operators and motions can be preceded by repetitions, i.e.
	\[
		\vimcmd{cmd,command} = \vimcmd{rep,n;opr,operator}\ \vimcmd{rep,m;mtn,motion(s)}
	\]
	
	\vspace{-3mm}
	\begin{pexample}
		\tabulinesep=1.2mm
		\centering
		\begin{tabu}[H]{!l^l^l}
			\toprule
			\rowstyle{\bfseries}
			Command & Syntax & Keys \\
			\midrule
			3$\times$ delete word  & \vimcmd{rep,3;opr,del;mtn,word} & \keys{3,d,w} \\
			Delete 3 words & \vimcmd{opr,del;rep,3;mtn,word} & \keys{d,3,w} \\
			\bottomrule
		\end{tabu}
	\end{pexample}
\end{frame}

\begin{frame}
	\frametitle{List of Operators}
	Main vim operator keys:

	\begin{table}
		\centering
		\begin{tabular}{>{\rowmac}l>{\rowmac}l|>{\rowmac}l>{\rowmac}l}
			\toprule
			\setrow{\bfseries}
			Key & Func. & Key & Func.
			\clearrow \\
			\midrule
			\key{y} & copy   & \key{c} & change (delete + insert) \\
			\key{d} & delete & \key{x} & delete single\\
			\key{p} & paste  & \key{P} & paste before \\
			\key{u} & undo   & \key{Ctrl}+\key{r} & redo \\
			\key{.} & repeat action & \key{;} & repat motion \\
			\bottomrule
		\end{tabular}
	\end{table}
\end{frame}

\begin{frame}
	\frametitle{List of Motions}
	Main vim motion (navigation) keys:

	\begin{table}
		\centering
		\begin{tabular}{>{\rowmac}l>{\rowmac}l|>{\rowmac}l>{\rowmac}l}
			\toprule
			\setrow{\bfseries}
			Key & Func. & Key & Func.
			\clearrow \\
			\midrule
			\key{w} & next word & \key{b} & beginning of word \\
			\key{e}/\key{g}\key{e} & end of word / prev & \key{n} & next find \\
			\key{n} & next find & \key{N} & prev find \\
			\key{f}\key{$\alpha$} & next $\alpha$ & \key{F}\key{$\alpha$} & prev $\alpha$ \\
			\key{t}\key{$\alpha$} & before next $\alpha$ & \key{T}\key{$\alpha$} & after prev $\alpha$ \\
			\bottomrule
		\end{tabular}
	\end{table}
\end{frame}

\begin{frame}
	\frametitle{Operators without Motions}
	Some operators don't need motions:
	
	\vspace{-5mm}
	\begin{table}
		\centering
		\begin{tabular}{>{\rowmac}l>{\rowmac}l|>{\rowmac}l>{\rowmac}l}
			\toprule
			\setrow{\bfseries}
			Key & Func. & Key & Func.
			\clearrow \\
			\midrule
			\multicolumn{4}{c}{\textbf{\color{vimgreen}Visual mode}}\\
			\key{U} & make uppercase & \key{u} & make lowercase\\
			\key{\textasciitilde} & switch case & & \\
			\midrule
			\multicolumn{4}{c}{\color{vimgreen}\textbf{Normal mode}}\\
			\key{ctrl}+\key{a} & increment int & \key{ctrl}+\key{x} & decrement int\\
			\keys{g,U,$\cdots$} & make uppercase & \keys{g,u,$\cdots$} & make lowercase\\
			\key{g,\textasciitilde,$\cdots$} & switch case & & \\
			\bottomrule
		\end{tabular}
	\end{table}
\end{frame}

\begin{frame}
	\frametitle{Operators without Motions}
	Some more operators without motions:
	
	\vspace{-5mm}
	\begin{table}
		\centering
		\begin{tabular}{>{\rowmac}l>{\rowmac}l|>{\rowmac}l>{\rowmac}l}
			\toprule
			\setrow{\bfseries}
			Key & Func. & Key & Func.
			\clearrow \\
			\multicolumn{4}{c}{\color{vimgreen}\textbf{Normal mode}}\\
			\key{u} & undo & \key{Ctrl}+\key{r} & redo\\
			\bottomrule
		\end{tabular}
	\end{table}
\end{frame}

\begin{frame}
	\frametitle{Motions without Operators}
	...and some motions aren't actually relevant to operators and repetitions:
	
	\vspace{-5mm}
	\begin{table}
		\centering
		\begin{tabular}{>{\rowmac}l>{\rowmac}l|>{\rowmac}l>{\rowmac}l}
			\toprule
			\setrow{\bfseries}
			Key & Func. & Key & Func.
			\clearrow \\
			\midrule
			\key{h}/\key{\aleft} & left & \key{j}/\key{\adown} & down \\
			\key{k}/\key{\aup} & up & \key{l}/\key{\aright} & right \\
			\key{0} & start of line & \key{\$} & end of line \\
			\key{\^{}} & start of line (text) & \key{\%} & matched paranthesis \\
			\key{H} & top of view & \key{L} & bottom of view \\
			\key{M} & middle of view & \key{L} & bottom of view \\
			\key{Ctrl}+\key{y} & scroll screen up & \key{Ctrl}+\key{e} & scroll screen down \\
			\bottomrule
		\end{tabular}
	\end{table}
\end{frame}

\begin{frame}
	\frametitle{Modifiers}
	The following two keys are \textbf{Modifiers}:

	\centering
	\begin{tabular}{>{\rowmac}l>{\rowmac}l}
		\toprule
		\setrow{\bfseries}
		Key & Meaning
		\clearrow \\
		\midrule
		\key{i} & Inside an object\\
		\key{a} & Around an object\\
		\bottomrule
	\end{tabular}

	\vspace{-2mm}
	\begin{pexample}
		\tabulinesep=0.7mm
		\centering
		\begin{tabu}[H]{!l^l}
			\toprule
			\rowstyle{\bfseries}
			Command & Keys \\
			\midrule
			Copy around '[]' & \keys{y,a,[} \\
			Delete inside `\{\}` & \keys{d,i,\{} \\
			\bottomrule
		\end{tabu}
	\end{pexample}
\end{frame}

\begin{frame}
	\frametitle{The Command Buffer}
\end{frame}

\begin{frame}
	\frametitle{Marks}
	Points in a file can be marked for later use. There are 52 possible custom marks: all lowercase letters + all uppercase letters.

	Adding a mark \textit{a} is done by

	\centering
	\keys{m,a}
	\flushleft

	Navigating to a mark \textit{a} is done by \keys{`,a}.

	The combination \keys{',a} will jump to the start of the line where the mark is.
\end{frame}

\begin{frame}
	\frametitle{Macros}
	A \textbf{macro} is a recording of a set of operations, which can be repeated as many times as needed.

	A macro \textit{a} is recorded by typing \keys{q,a} [set of operations] \keys{q}.

	A macro \textit{a} is called by \keys{@,a}.
\end{frame}

\begin{frame}
	\frametitle{Find, Search \& Replace, Regex}
	Searching for a string is done by pressing \key{/} (\key{?} for backwards search), and entering a regex-like search query.

	Moving between matches can be done via \key{n} for forward search, and \key{N} for back search.

	The word currently under the cursor can be searched by \key{*} for a forward search, and \key{\#} for backwards search.

	As with commands, the search history is searchable via \key{\aup} and \key{\adown}.
\end{frame}

\begin{frame}
	\frametitle{Find, Search \& Replace, Regex}
	Replacing an expression is done via 
\end{frame}

\begin{frame}
	\frametitle{Splits}
\end{frame}
\end{document}
